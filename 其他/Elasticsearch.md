# ElasticSearch

version: ^8

## 开始

### 基本概念

#### 接近实时

ElasticSearch是一个接近实时的搜索平台。从索引开始到这个文档被搜索到有一个很小的延迟

#### 集群（cluster）

集群由一个或多个节点组织在一起，共同持有全部数据，并且一起提供索引和搜索功能。
存在一个唯一标识的名称，默认为“elasticsearch”
节点必须通过这个标识来加入到某个集群。
集群只有一个节点是合法的，可以拥有多个集群

#### 节点（node）

属于集群中的一个服务器，作为集群中的一个成员，存储数据，参与集群的索引和搜索。
标识方式是一个名称，默认是随机的名称
节点可以通过配置集群名称的方式加入到某个集群中，默认加入到“elasticsearch”

#### 索引（index）

拥有相似特征的文档集合。
索引由索引名称标识（全部小写字母），会在增删改查的时候用到
一个集群可以有多个索引

#### 类型（type）

一个索引中，可以定义一种或多种类型
一个类型是，索引的一个逻辑上的分类/分区
通常，会为一组相同字段的文档定义一个类型

#### 文档（document）

一个文档是一个可被索引的基础信息单元
文档的格式是JSON
在一个index/type中，可以存储任意多的文档

#### 分片和复制

ES提供将索引划分为多片的功能，这些片称之为分片
分片可以水平分割/扩展内容容量，并且可以在分片上进行分布式的、并行的操作
分片因节点离线或消失的情况下，会触发 故障转移机制
ES会为分片创建一份或多份拷贝，或者说复制
复制提高了可用性（复制的分片与原分片不在同一个节点）
搜索可以在复制上并行运行，可以提高吞吐量
默认情况下，ES为每个索引分配5个主分片和1个复制

### 安装

1. 需要Java环境

2. 下载二进制文件
`www.elasticsearch.org/download`

3. 解压并进入bin目录，启动节点和单节点集群
`./elasticsearch` 或 双击 `elasticsearch.bat`
或者可以覆盖默认的节点名称和集群名称：
`./elasticsearch --cluster.name cluster_name --node.name node_name`

4. 默认情况下，ElasticSearch通过9200端口提供对其Restful API的访问

5. 通过 `localhost:9200` 来查看启动是否成功

### 操作集群

#### rest api 接口

1. 查询集群、节点、索引的健康状态和相关的统计信息
2. 管理集群、节点、索引数据和元数据
3. 对索引进行 CRUD 和 搜索
4. 高级查询，如分页、排序、过滤、脚本、聚合等等

#### 健康

查询集群健康：
`localhost:9200/_cat/health?v`

状态：
- 绿色：一切正常
- 黄色：数据都可用，但某些复制没有被分配
- 红色：某些数据不可用

查询节点列表：
`localhost:9200/_cat/nodes?v`

#### 所有索引

`localhost:9200/_cat/indices?v`

#### 创建索引

PUT: `localhost:9200/customer?pretty`

#### 索引并查询一个文档

```
curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'
```
